---
title: æ•°æ®åº“å®éªŒè®°å½•
date: 2018-12-18 19:08:48
tags:
---

# å®éªŒä¸€
## å»ºè¡¨ä¸ç®€å•æ“çºµ
~~~
ğŸ˜ƒğŸ˜ƒğŸ˜ƒ
~~~

~~~
create database EDUC
on 
(
	name = 'student_data',
	filename = '/var/opt/mssql/tudent_data.mdf',
	size = 10,
	filegrowth = 5%,
	maxsize = 50
	)
log on
(
	name = 'student_log',
	filename = '/var/opt/mssql/student_log.ldf',
	size = 2,
	maxsize = 5,
	filegrowth = 1
	)
create table  student
(
	sno char(8) not null constraint PK_student primary key ,
	sname char(8) not null ,
	sex char(2),
	native char (20),
	birthday smalldatetime ,
	dno char(6) ,
	entime smalldatetime,
	home varchar(40),
	tel varchar(40),
	)
create table course
(
	cno char(10) not null primary key , --class id
	spno char(8) , -- major
	cname char(20) not null , -- class name
	experiment tinyint,    --ex time sy
	lecture tinyint    --le time
	)
create table student_course
(
	sno char(8) not null primary key,
	cno char(10) not null ,
	score tinyint 
	)
create table teacher
(
	tno char(8) not null primary key,
	tname char(8) not null ,
	sex char(2) ,
	birthday smalldatetime ,
	dno char(6) ,
	pno tinyint ,
	home varchar(40),
	tel varchar(40),
	)
create table teacher_course
(
	tno char(8) not null constraint T_Force foreign key references teacher(tno),
	classno char(4),
	cno char(10) not null constraint C_Force foreign key references course(cno),
	classtime varchar(40),
	classroom varchar(40),
	weektime tinyint,
	)

alter table course add year datetime

alter table course alter column year smalldatetime

alter table course add constraint year check(year between 2004 and 2012)

alter table course drop year

alter table course drop column year

insert into student (sno,sname,sex,birthday,dno,entime,home,tel)
values ('800130','w0x7c3','m','1998-11-02 ','idiot','2017-09-01','Jin','+17654000663')

update student set native='Jining Shandong' where sname='w0x7c3'
~~~

# å®éªŒäºŒ
## å»ºè¡¨
~~~
create database BR
on
(
	name = 'book_reader_data',
	filename = '/var/opt/mssql/book_reader.mdf',
	size = 10 ,
	filegrowth = 5%,
	maxsize = 50
	)
log on 
(
	name = 'book_reader_log',
	filename = '/var/opt/mssql/book_reader.ldf',
	size = 2,
	maxsize = 5,
	filegrowth = 1
	)
create table book 
(
	bno char(10) constraint bkey primary key not null,
	bsort char(12) ,
	bpublish char(50) not null,
	author char (20) ,
	bname char(50) not null,
	bprice money(8) ,
	)
create table reader
(
	rnu char(10) not null constraint rkey primary key ,
	rname char(8) not null,
	rwork char(50) ,
	rsex char(2) constraint csex check(rsex=='ç”·' or rsex == 'å¥³') ,
	rtel char(15),
	)	
create table borrow
(
	number char(10) primary key ,
	bnu char(10),
	rnu	char(10),
	bdata datetime ,
	)
~~~	

##æ’å…¥æ•°æ®
~~~
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1001','è®¡ç®—æœº','æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾','ç‹æ°‘','æ•°æ®ç»“æ„','80')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1002','è®¡ç®—æœº','æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾','å¼ å»ºå¹³','è®¡ç®—æœºåº”ç”¨','20')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1003','è®¡ç®—æœº','ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾','ç‹æ•','æ•°æ®åº“æŠ€æœ¯','15')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1004','è®¡ç®—æœº','ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾','è°­æµ©å¼º','cè¯­è¨€','25')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1005','è‹±è¯­','ä¸­å›½äººæ°‘å¤§å­¦å‡ºç‰ˆç¤¾','å¼ é”¦èŠ¯','åº”ç”¨ä½œæ–‡å†™ä½œ','25')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1006','ç®¡ç†','é«˜ç­‰æ•™è‚²å‡ºç‰ˆç¤¾','Robison','ç®¡ç†å­¦','15')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1007','ç®¡ç†','æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾','Fayol','å·¥ä¸šç®¡ç†','70')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1008','æ•°å­¦','æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾','æå¹³','çº¿æ€§ä»£æ•°','50')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1009','ç®¡ç†','æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾','Durark','å…¬å¸çš„æ¦‚å¿µ','14')
insert into book (bno,bsort,bpublish,author,bname,bprice)
values ('1010','æ•°å­¦','æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾','å¾æ–°å›½','ç»Ÿè®¡å­¦','15')
~~~
~~~	
insert into borrow (number,bnu,rnu)
values ('1','1001','1003')
insert into borrow (number,bnu,rnu)
values ('2','1002','1004')
insert into borrow (number,bnu,rnu)
values ('3','1003','1005')
insert into borrow (number,bnu,rnu)
values ('4','1004','1006')
insert into borrow (number,bnu,rnu)
values ('5','1005','1007')
insert into borrow (number,bnu,rnu)
values ('6','1006','1008')
insert into borrow (number,bnu,rnu)
values ('7','1007','1009')
insert into borrow (number,bnu,rnu)
values ('8','1008','1010')
insert into borrow (number,bnu,rnu)
values ('9','1009','1011')
insert into borrow (number,bnu,rnu)
values ('10','1010','1012')
~~~
~~~
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1001','ä¸ä¸€','æ•°å­¦é™¢','ç”·','81234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1002','èµµäºŒ','ç»æµå­¦é™¢','ç”·','82234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1003','å¼ ä¸‰','ç®¡ç†å­¦é™¢','å¥³','83234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1004','æå››','æ–‡å­¦é™¢','ç”·','84234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1005','ç‹äº”','å†å²æ–‡åŒ–å­¦é™¢','å¥³','85234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1006','å­™å…­','ç‰©ç†å­¦é™¢','ç”·','86234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1007','å‘¨ä¸ƒ','ç”Ÿå‘½ç§‘å­¦é™¢','å¥³','87234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1008','å¾å…«','åŒ–å­¦é™¢','ç”·','88234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1009','å®‹ä¹','ä¿¡æ¯å­¦é™¢','å¥³','89234567')
insert into reader (rnu,rname,rwork,rsex,rtel)
values ('1010','åˆ˜å','è®¡ç®—æœºå­¦é™¢','å¥³','90234567')
~~~

##æ“çºµ
~~~
use br
---æŸ¥æ‰¾è¿™æ ·çš„å›¾ä¹¦ç±»åˆ«ï¼šè¦æ±‚ç±»åˆ«ä¸­æœ€é«˜çš„å›¾ä¹¦å®šä»·ä¸ä½äºæŒ‰ç±»åˆ«åˆ†ç»„çš„å›¾ä¹¦çš„å¹³å‡å®šä»·çš„2 å€
--select bsort from book group by bsort having max(bprice)>=all(select 2*avg(bprice) from book group by bsort)
---éªŒè¯
--select 2*avg(bprice),bsort,max(bprice) from book group by bsort
---æ±‚æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆçš„å„ç±»å›¾ä¹¦çš„å¹³å‡å®šä»·ï¼Œåˆ†åˆ«ç”¨GROUP BY
--select avg(bprice),bsort from book  where (bpublish='æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾') group by bsort
---éªŒè¯
---select bprice,bsort from book  where (bpublish='æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾') 
---åˆ—å‡ºè®¡ç®—æœºç±»å›¾ä¹¦çš„ä¹¦å·ã€åç§°åŠä»·æ ¼ï¼Œæœ€åæ±‚å‡ºå†Œæ•°å’Œæ€»ä»·æ ¼ã€‚
--select bname,bprice from book where bsort like 'è®¡ç®—æœº' 
--select count(*) from book where bsort='è®¡ç®—æœº'
--select sum(bprice) from book where bsort like 'è®¡ç®—æœº'
--æŸ¥è¯¢è®¡ç®—æœºç±»å’Œæœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾å‡ºç‰ˆçš„å›¾ä¹¦ã€‚
--select distinct bpublish from book  where( bsort like '%è®¡ç®—æœº%' or bsort like '%æœºæ¢°å·¥ä¸šå‡ºç‰ˆ%' )
~~~

#å®éªŒä¸‰
## å»ºè¡¨
~~~
create database en_tools
on
(
	name='en-tools_data',
	filename='/var/opt/mssql/en-tools.ldf',
	size=10,
	filegrowth=5%,
	maxsize=50
	)
log on
(
	name='en-tools_log',
	filename='/var/opt/mssql/en-tools.mdf',
	size=2,
	maxsize=5,
	filegrowth=1
	)
create table S
(
	sno char(5) constraint S_pk primary key,
	sname char(20) ,
	scity char(20) ,
	stel char(20) ,
	)
create table J
(
	jno char(5) constraint J_pk primary key,
	jname char(50) ,
	jmaster char(10) ,
	jplan char(8),
	)
create table P
(
	pno char(5) constraint P_pk primary key,
	pname char(50),
	ptype char(10),
	plocal char(20),
	pcolor char(10),
	)
create table SPJ
(
	spj_sno char(5),
	spj_jno char(5),
	spj_pno char(5),
	spj_count int(4),
	constraint SPJ_pk primary key(spj_jno,spj_count,spj_sno)
	)
~~~
## æ’å…¥æ•°æ®
~~~
insert into S(sno,sname,scity,stel)
values('S1','åŒ—äº¬ä¾›åº”å•†','åŒ—äº¬','0108888888')
insert into S(sno,sname,scity,stel)
values('S2','å¤©æ´¥ä¾›åº”å•†','å¤©æ´¥','022888888')
insert into S(sno,sname,scity,stel)
values('S3','é‡åº†ä¾›åº”å•†','é‡åº†','023888888')
insert into S(sno,sname,scity,stel)
values('S4','ä¸Šæµ·ä¾›åº”å•†1','ä¸Šæµ·','021888888')
insert into S(sno,sname,scity,stel)
values('S5','å¹¿å·ä¾›åº”å•†','å¹¿å·','020888888')
insert into S(sno,sname,scity,stel)
values('S6','ä¸Šæµ·ä¾›åº”å•†2','ä¸Šæµ·','0216666666')
~~~
~~~
insert into J (jno,jname,jmaster,jplan)
values('J1','å·¥ç¨‹1','ä¸ä¸€','200000')
insert into J (jno,jname,jmaster,jplan)
values('J2','å·¥ç¨‹2','èµµäºŒ','60000')
insert into J (jno,jname,jmaster,jplan)
values('J3','å·¥ç¨‹3','å¼ ä¸‰','70000')
insert into J (jno,jname,jmaster,jplan)
values('J4','å·¥ç¨‹4','æå››','80000')
insert into J (jno,jname,jmaster,jplan)
values('J5','å·¥ç¨‹5','ç‹äº”','150000')
~~~
~~~
insert into P(pno,pname,ptype,plocal,pcolor)
values('P1','èºä¸','ä¸­','æµå—','çº¢è‰²')
insert into P(pno,pname,ptype,plocal,pcolor)
values('P2','ä¸»æ¿','é›†æˆ','æ·±åœ³','ç»¿è‰²')
insert into P(pno,pname,ptype,plocal,pcolor)
values('P3','æ˜¾å¡','ç‹¬ç«‹','é¦™æ¸¯','è“è‰²')
insert into P(pno,pname,ptype,plocal,pcolor)
values('P4','å£°å¡','é›†æˆ','å¤©æ´¥','çº¢è‰²')
insert into P(pno,pname,ptype,plocal,pcolor)
values('P5','ç½‘å¡','100M','ä¸Šæµ·','é»‘è‰²')
insert into P(pno,pname,ptype,plocal,pcolor)
values('P6','é¼ æ ‡','æ— çº¿','ä¸Šæµ·','é»‘è‰²')
~~~
~~~
insert into SPJ(spj_sno,spj_jno,spj_pno,spj_count)
values('S1','J2','P4','50')
insert into SPJ(spj_sno,spj_jno,spj_pno,spj_count)
values('S2','J3','P5','100')
insert into SPJ(spj_sno,spj_jno,spj_pno,spj_count)
values('S3','J2','P6','500')
insert into SPJ(spj_sno,spj_jno,spj_pno,spj_count)
values('S4','J1','P3','150')
insert into SPJ(spj_sno,spj_jno,spj_pno,spj_count)
values('S4','J5','P1','200')
insert into SPJ(spj_sno,spj_jno,spj_pno,spj_count)
values('S5','J4','P6','100')
insert into SPJ(spj_sno,spj_jno,spj_pno,spj_count)
values('S6','J','P2','90')
~~~
## æ“çºµ
~~~
select sno as ä¾›åº”å•†ä»£ç  , sname as å§“å from s 
where sno in (select spj_sno from SPJ 
				where spj_sno = 'J4' and spj_pno in (
				select pno from p
				where pcolor = 'çº¢è‰²')
				)
select jno as å·¥ç¨‹ä»£ç  from S,SPJ 
where not exist(select * from SPJ 
				where S.sno=SPJ.spj_sno and scity='ä¸Šæµ·')
select jno as å·¥ç¨‹ä»£ç  from J,
select distinct spj_jno from spj where spj_sno like 's5'
~~~

#å®éªŒå››
## æ“çºµ

~~~

æ˜¾ç¤ºæ‰€æœ‰ä¸“ä¸šå·ä¸ºâ€˜001â€™ï¼Œå¹¶ä¸”åœ¨æœåŠ¡å™¨æ˜¾ç¤ºä¹‹å‰ï¼Œæš‚åœ  1  åˆ†é’Ÿ
timefor delay '00:01'
select * from course where spno='001'

æŠŠæ‰€æœ‰è®¡ç®—æœºè½¬å­¦å­¦ç”Ÿçš„è”ç³»ç”µè¯åˆ æ‰ï¼Œæ‰€æœ‰ä¸“ä¸šå·ä¸ºâ€˜001â€™çš„å­¦ç”Ÿ
çš„å…¥å­¦æ—¶é—´åˆ æ‰ï¼Œæ‰€æœ‰ä¸“ä¸šä¸“ä¸šå·ä¸ºâ€˜003.â€™çš„å­¦ç”Ÿçš„ç­çº§å·æ”¹ä¸ºâ€˜001â€™ï¼Œ
å…¶ä»–çš„å­¦ç”Ÿåˆ æ‰å…¶ç±è´¯ã€‚ï¼ˆcaseï¼‰
update student 
set entime = (case spno 
	when '001' then null else entime end)
 	classno = (case spn
	when '003' then '001' else classno end)
	native = (case spno when '001' native case class when '003' then native else null end )
~~~

{% aplayer "æ˜æœˆå¤©æ¶¯" "æ°´ç¥å…’"
 "/root-images/æ°´ç¥å…’-æ˜æœˆå¤©æ¶¯(Coveräº”éŸ³Jw).mp3" "autoplay" %}